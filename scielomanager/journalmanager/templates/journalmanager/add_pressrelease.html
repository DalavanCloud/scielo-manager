{% extends "base_form_lv0.html" %}
{% load i18n %}
{% load static %}
{% load scielo_common %}
{% load widget_tweaks %}

{% block page_title %}{% trans "Press release" %} - {{journal.title}}{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
  <li>
    <a href="{% url index %}">{% trans 'Home' %}</a>
    <span class="divider">/</span>
  </li>
  <li>
    <a href="{% url journal.index %}">{% trans 'Journals Dashboard' %}</a>
    <span class="divider">/</span>
  </li>
  <li>
    <a href="{% url section.index journal.id %}">{{journal.title}}</a>
    <span class="divider">/</span>
  </li>
  <li class="active">{% trans 'New press release' %}</li>
</ul>
{% endblock %}

{% block form_content %}
<form id="section-form"
      method="POST"
      action=""
      enctype="application/x-www-form-urlencoded">
  {% csrf_token %}

  {% if request.GET.popup %}
    <input type="hidden" value="1" name="popup" />
  {% endif %}

  <span class="label">{% trans "Press release info" %}</span>
  <div class="well">
    <div class="clearfix {% if pressrelease_form.issue.errors %}error{% endif %}">
      {{ pressrelease_form.issue.label_tag }}
      <div class="input">
        {{ pressrelease_form.issue }}
      </div>
    </div>

    <table id="translation_formset"
           class="table table-bordered table-striped">
      <thead>
        <tr>
          <td>
            <span {% if translation_formset.forms.0.language.field.required %}class="req-field"{% endif %}>
              {% trans 'Language' %}
            </span>
          </td>
          <td>
            <span {% if translation_formset.forms.0.title.field.required %}class="req-field"{% endif %}>
              {% trans 'Title' %}
            </span>
          </td>
          <td>
            <span {% if translation_formset.forms.0.content.field.required %}class="req-field"{% endif %}>
              {% trans 'Content' %}
            </span>
          </td>
        </tr>
      </thead>
      <tbody>
        {% for form in translation_formset %}
        <tr id="{{ form.prefix }}-row">
          <td>
            <div class="control-group {% if form.errors %}error{% endif %}">
              {{ form.language }}
            </div>
          </td>
          <td>
            <div class="control-group {% if form.errors %}error{% endif %}">
              {{ form.title }}
            </div>
          </td>
          <td>
            <div class="control-group {% if form.errors %}error{% endif %}">
              {{ form.content }}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <table id="article_formset"
           class="table table-bordered table-striped">
      <thead>
        <tr>
          <td>
            <span {% if article_formset.forms.0.article_pid.field.required %}class="req-field"{% endif %}>
              {% trans 'Article PID' %}
            </span>
          </td>
        </tr>
      </thead>
      <tbody>
        {% for form in article_formset %}
        <tr id="{{ form.prefix }}-row">
          <td>
            <div class="control-group {% if form.errors %}error{% endif %}">
              {{ form.article_pid }}
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {{ translation_formset.management_form }}
    {{ article_formset.management_form }}
  </div>

  <div class="row-fluid">
    <input
      class="btn btn-primary"
      name="submit"
      type="submit"
      value="{% trans 'save' %}" />
    <input
      class="btn btn-warning"
      type="reset"
      value="{% trans 'cancel' %}"
      {% if request.GET.popup %}
        onclick="javascript: window.close()"
      {% else %}
        onclick="javascript: window.history.back()"
      {% endif %}
    />
  </div>
</form>
{% endblock %}

{% block extrafooter %}
{{ block.super }}
  <script>
    $(document).ready(function() {
      $('#translation_formset tbody tr').formset({
        formCssClass: 'dynamic-translation_formset-form',
        prefix: '{{ translation_formset.prefix }}'
      });
      $('#article_formset tbody tr').formset({
        formCssClass: 'dynamic-article_formset-form',
        prefix: '{{ article_formset.prefix }}'
      });
    });
  </script>
{% endblock %}
